{"name":"MC Kernel","tagline":"Calculate seismic sensitivity kernels using Axisem","body":"![](https://raw.githubusercontent.com/sstaehler/kerner/master/doc/Logo.png?token=AE0eePWntw2plejxLzd4JL8W0MWxSKoQks5WFnW3wA%3D%3D)\r\n\r\n##Authors:\r\nSimon StÃ¤hler, Martin van Driel, Ludwig Auer, Kasra Hosseini, Tarje Nissen-Meyer\r\n\r\n## Download\r\nTo download the current developer version, use git clone\r\n```\r\ngit clone https://github.com/sstaehler/kerner\r\n```\r\n\r\n## Prequisites\r\nMC Kernel needs a recent Fortran compiler (gfortran 4.8 or later), an MPI installation, the NetCDF library for accessing the wavefield files, the FFTW library for Fourier transforms and LAPACK, because we were too lazy to write a matrix inversion routine ourselves. The installation of these libraries can be done by hand on desktop machines or using modules on HPC environments.\r\nThe recommended submit script uses Python and needs NetCDF4\r\n#### Ubuntu/Debian Linux\r\nSince Ubuntu 14.04LTS, the system libraries can be used:\r\n```bash\r\nsudo apt-get install gfortran libnetcdff5 libfftw3-dev libblas3 openmpi-bin gfortran python python-netcdf\r\n```\r\n\r\n#### MacOS X\r\nWe recommend using Homebrew to download and compile the necessary libraries. Be careful to add the *--with-fortran* argument while installing any library. Otherwise, only C libraries are installed. If you did install the libraries before without the *--with-fortran* argument, it may be necessary to remove and reinstall them.\r\n\r\n#### HPC environments\r\nBe sure to load modules for Fortran, NetCDF, FFTW and LAPACK.\r\nOn SuperMUC, the necessary commands are\r\n```\r\nmodule load fortran\r\nmodule load netcdf/4.2\r\nmodule load fftw\r\nmodule load mkl\r\n```\r\n\r\n## Installation\r\nChange into the download directory and copy the included template files into the main directory\r\n```bash\r\ncd kerner\r\n./copy_templates.sh\r\n```\r\nThe file *make_mc_kerner.macros* allows you to modify the compiler name and compiler flags according to your system. To compile, use make\r\n```bash\r\nmake \r\nmake test \r\n```\r\nto run a set of tests.\r\n\r\n## AxiSEM wavefields\r\nUsing the code requires computation of a global seismic wavefield using AxiSEM. Please refer to the AxiSEM documentation on how to do this. An set of example wavefields with a dominant period of 40s can be downloaded:\r\n```\r\nwget https://www.geophysik.uni-muenchen.de/~staehler/kernel_wavefields_40s.tar.gz\r\ntar -xvf kernel_wavefields_40s.tar.gz\r\n```\r\n\r\n## Usage\r\nTo run the code, a convenient submit script is available:\r\n```bash\r\npython submit.py -n NSLAVES JOB_NAME\r\n```\r\nThis creates a run directory *JOB_NAME*, puts the default input files there and starts a MPI job with one master and NSLAVES worker tasks. In this simple form, it uses default values stored in the files *CMTSOLUTION*, *receivers.dat*, *filters.dat* and *stf_20s.dat* together with AxiSEM wavefields in ./wavefield/fwd and ./wavefield/bwd.  \r\nModifying the settings for the run is possible by setting one of the options of submit.py, which can be queried by\r\n```bash\r\npython submit.py -h\r\n```\r\n\r\n## Plot results\r\nMC Kerner comes with a set of simple Python plotting scripts to visualize kernels and the seismograms they are based on. They can be found in the folder **pyfiles** and need a few extra programs to run:\r\n * Paraview (version >= 4.3)\r\n * Python packages matplotlib and wand\r\n\r\nTo run the scripts change into the job directory\r\n```bash\r\ncd JOB_DIR\r\n```\r\nand run\r\n```bash\r\npython ../pyfiles/plot_all_seismograms.py\r\npvpython ../pyfiles/plot_all_kernels.py\r\npython ../pyfiles/create_composites.py\r\n```\r\n\r\n\r\n\r\n\r\n\r\n\r\n## FAQs\r\n### Anaconda interference \r\nThe python package manager Anaconda installs his own version of gfortran, which interferes with the system version and the MPI libraries. \r\nA solution is to replace the compiler name *FC* and the *MPIRUN* variable in *make_mc_kerner.macros* with absolute paths\r\n```bash\r\nFC = /usr/bin/mpif90\r\n```\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}